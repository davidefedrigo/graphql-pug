<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Building My First GraphQL Server in PHP</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/mine.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-markdown data-background-image="img/copertina.jpg">
					<textarea data-template>
						### Building my first GraphQL server in PHP
						@davidefedrigo
					</textarea>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
							#### Agenda

							- PHP libraries
							- Tooling
							- Meet GraphQL

						</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
						### Disclaimer
						Never done it before!

						_(using PHP)_
						<aside class="notes">
							- Racconterò il mio percorso in PHP
							</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<textarea data-template>
						GraphQL has been released only as a specification
						<aside class="notes">
							- Solo un lungo documento che descrive comportamento di un GL server.

							- Linguaggio indifferente.
							
							- In ogni linguaggio stessi concetti.
						</aside>
					</textarea>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
						## Meet GraphQL
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					A GraphQL service is created by defining types

					and fields on those types

					```
					type Query {
						randomMovie: Movie!
					}

					type Movie {
						id: ID
						title: String
					}
					```

					Along with functions for each field on each type<!-- .element: class="fragment" data-fragment-index="0" -->
					<aside class="notes">
						- GraphQL schema language
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
						GraphQL Query

						```
						{
							randomMovie {
								title
							}
						}
						```
						
						JSON Result
						```
						{
							"data": {
								"randomMovie": {
									"title": "Back to the Future"
								}
							}
						}
						```
						<aside class="notes">
							- Dove si pongono all'interno di una interazione client server?
						</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					#### Client-Server Interaction
					![Client Server Interaction](img/client-server-interaction.png)

					<aside class="notes">Most of our time will be spent focusing on how to define our GraphQL schema and tie it to our application business logic, and that’s what we will move on to next.</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					### Show me the code!

					##### not yet, two more steps // we need two more things:<!-- .element: class="fragment" data-fragment-index="1" -->

					1. PHP library<!-- .element: class="fragment" data-fragment-index="1" -->
					2. Handy client<!-- .element: class="fragment" data-fragment-index="1" -->
					<aside class="notes">
						- Di cosa abbiamo bisogno per fare la demo?
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					### PHP Libraries Comparison

					|||
					| --- | --- |
					| A | B |
					<aside class="notes">
						
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					### GraphQL Clients Comparison

					|||
					| --- | --- |
					| A | B |
					<aside class="notes">
						
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					### Coding Session

					Minimal Example
					<aside class="notes">
						- Super base
						- Tenuto volutamente tutto in un controller per vedere cosa basta avere
						- Fare notare le variables, argomento successivo
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					### User Input

					By using the type system, it can be predetermined whether a GraphQL query is valid or not
					<aside data-markdown class="notes">
						- *validare user input* attraverso il type checking
						- contare su _layer_ davanti che si occupa della **validazione**
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					### User Input Validation

					```
					query {
						actors(matching: 1) {
							name
						}
					}					
					```

					```
{
	"errors": [
		{
			"message": "Field \"actors\" argument \"matching\"
			            requires type String!, found 1.",
			"extensions": {
				"category": "graphql"
			},
			"locations": [
				{
				    "line": 2,
				    "column": 20
				}
			]
		}
	]
}
					```
					<aside data-markdown class="notes">
						
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					### Field Arguments

					A way for users to parameterize queries
					```
					query {
						movies(year: 1985) {
							title(language: "it")
						}
					}
					```

					```
					{
						"data": {
							"movies": [
								{
									"title": "Ritorno al Futuro"
								},
								{
									"title": "I Goonies"
								}
							]
						}
					}
					```
					<aside class="notes">
						- to *provide input* to a specific field, to be used in their queries

						- every field and *nested object* can get its own set of arguments

						- good for making *multiple API fetches*
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					###### Providing Field Argument Values
					### As Document Literals

					```
					query {
						movies(year: 1985) {
							title(language: "it")
						}
					}
					```
					<aside class="notes">
						- Comodo per provare la query

						- Non riutilizzabile:
							- test: input valido vs inout non valido

							- interfaccia utente con input di ricerca

						- Rischio di documento malformato
							- occorrre interpolare input nella query

							- quindi validarlo/sanitizzarlo
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					###### Providing Field Argument Values
					### As Variables

					```graphql
					query ($year: Int, $language: String) {
						movies(year: $year) {
							title(language: $language)
						}
					}
					```

					```json
					{
						"year": 1985,
						"language": "it"
					}
					```
					<aside class="notes">
						- Il tipo viene validato

						- Riutilizzabile:

							- nei test

							- lato client per usare input

						- document GraphQL corretto

						- TIP: se tipo errato nelle varibili, viene castato prima di passare all'engine della query
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					### Using Enumeration Types

					A GraphQL enum is a special type of scalar that has a defined, finite set of possible values.
					```graphql
					query {
						movies {
							title(language: IT)
						}
					}
					```

					```graphql
					query ($language: Language) {
						movies {
							title(language: $language)
						}
					}
					```

					```js
					{
						"language": "IT"
					}
					```
					<aside class="notes">
						- Enum è uno tipo speciale di scalar che ha 
					</aside>
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
					### Coding Session

					User Input Examples
					</script>
				</section>
				<section data-markdown data-background-image="img/interna.jpg">
					<script type="text/template">
						### Abstract Types
						<aside class="notes">
							-
						</aside>
					</script>
				</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
```graphql
type Query {
  searchMovies(matching: String!): [ Movie! ]!
  searchTVSeries(matching: String!): [ TVSerie! ]!
}
```

```graphql
query {
  searchMovies(matching: "game") {
    title
    runningTime
  }
  searchTVSeries(matching: "game") {
    title
    seasons {
      episodes {
        runningTime
      }
    }
  }
}
```
<!-- .element: class="fragment" data-fragment-index="1" -->

<aside class="notes">
- Necessità
- Risultato di un solo tipo
</aside>
</script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
  ### Union Types

  _A GraphQL union type is an abstract type that represents a set of specific concrete types_
  <aside class="notes">
    -
  </aside>
</script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
### Union Types

```graphql
type Query {
  searchMovies(matching: String!): [ Movie! ]!
  searchTVSeries(matching: String!): [ TVSerie! ]!
}
```

```graphql
type Query {
  search(matching: String!): [ SearchResult! ]!
}

union SearchResult = Movie | TVSerie
```
<aside class="notes">
- Confronto prima e dopo
</aside>
</script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
```graphql
query {
  search(matching: "game") {
    ... on Movie {
      title
      runningTime
    }
    ... on TvSerie {
      title
      seasons {
        episodes {
          runningTime
        }
      }
    }
  }
}
```
<aside class="notes">
-
</aside>
</script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
```
{
  "data": {
    "search": [
      {
        "title": "Avengers: Endgame",
        "runningTime": 181
      },
      {
        "title": "Game of Thrones",
        "seasons": [
          {
            "episodes": [
              {
                "runningTime": 62
              },
              {
                "runningTime": 56
              }
            ]
          }
        ]
      }
    ]
  }
}
```
</section>
<section data-markdown data-background-image="img/interna.jpg">
  <script type="text/template">
    ### Interfaces

    _An Interface is an abstract type that includes a certain set of fields that a type must include to implement the interface_
    <aside class="notes">
      -
    </aside>
  </script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
### Interfaces

```
interface BasicSearchResult {
  title: String!
}

type Movie implements BasicSearchResult {
  title: String!
  runningTime: Int
}

type TVSerie implements BasicSearchResult {
  title: String!
  seasons: [Season!]!
}
```
<aside class="notes">
- 
</aside>
</script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
```
query {
  search(matching: "game") {
      title
    }
  }
}
```

```
{
  "data": {
    "search": [
      {
        "title": "Avengers: Endgame"
      },
      {
        "title": "Game of Thrones"
      }
    ]
  }
}
```
<aside class="notes">
- Torna ad essere molto semplice, poco rumore
</aside>
</script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
  <script type="text/template">
  ### Coding Session

  Abstract Types Examples
  </script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
### Operations
<aside class="notes">
- Query

- Mutation

- Subscription
</aside>
</script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
### Mutations

```
type Mutation {
  rateMovie(movieId: Int!, stars: Int!, comment: String): MovieReview
}

type MovieReview {
  movie: Movie!
  stars: Int!
  comment: String
}
```
<aside class="notes">
- Per convenzione, ogni richiesta che causa side-effect, che modifica dati

- root mutation type

- Solitamente le mutation che creano qualcosa, lo ritornano come risultato del campo

- possiamo richiedere determinati campi
</aside>
</script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
#### Modeling Input Objects

```
type Mutation {
  rateMovie(movieId: Int!, review: ReviewInput!): MovieReview
  rateTVSerie(tvSerieId: Int!, review: ReviewInput!): TvSerieReview
}

input ReviewInput {
  stars: Int!
  comment: String
}

type MovieReview {
  movie: Movie!
  stars: Int!
  comment: String
}

type TvSerieReview {
  tvSerie: TvSerie!
  stars: Int!
  comment: String
}
```
<aside class="notes">
- WatchlistItem potrebbe essere una union di Movie e TVSeries
</aside>
</script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
```graphql
mutation($movieId: Int!, $review: ReviewInput!) {
  rateMovie(movieId: $movieId, review: $review) {
    movie {
      title
      stars
    }
    stars
  }
}
```

```js
{"movieId": 1, "review": {"stars": 5, "comment": "Awesome!"}}
```

```js
{
  "data": {
    "rateMovie": {
      "movie": {
        "title": "Avengers: Endgame",
        "stars": 4.2
      },
      "stars": 5
    }
  }
}
```
<aside class="notes">
- 
</aside>
</script>
</section>
<section data-markdown data-background-image="img/interna.jpg">
<script type="text/template">
	### Additional Interesting Topics

	- Errors and exceptions<!-- .element: class="fragment" data-fragment-index="0" -->
	- Keep resolvers and domain logic separated<!-- .element: class="fragment" data-fragment-index="1" -->
	- N+1 problem<!-- .element: class="fragment" data-fragment-index="2" -->
	- Authentication<!-- .element: class="fragment" data-fragment-index="3" -->
	- Testing<!-- .element: class="fragment" data-fragment-index="4" -->
	- Custom Scalar Types<!-- .element: class="fragment" data-fragment-index="5" -->
</script>
</section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				],
				// Add the current slide number to the URL hash so that reloading the
				// page/copying the URL will return you to the same slide
				hash: true,
			});
		</script>
	</body>
</html>
